services:
  ambrosia:
    # Use local build instead of pulling image
    build: .
    image: ambrosia:local
    ports:
      - "1965:1965"
      - "127.0.0.1:9568:9568"   # Metrics (localhost only)
    volumes:
      - ./gemini:/app/gemini:ro
      - ./certs:/certs:ro
      - ./gemini-sample:/app/gemini-sample:ro  # For testing sample content
    environment:
      - HOSTNAME=localhost
      - ROOT_DIR=/app/gemini
      - METRICS_ENABLED=true    # Enable metrics for dev
      - LOG_LEVEL=debug         # More verbose logging
      - RATE_LIMIT_REQUESTS=20  # More suitable for dev but can be changed for testing
      - RATE_LIMIT_WINDOW_MS=1000
      - GEMINI_PORT=1965
      - CERT_FILE=/certs/cert.pem
      - KEY_FILE=/certs/key.pem
      - MAX_CONNECTIONS=1000
      - REQUEST_TIMEOUT=10000
    restart: unless-stopped
